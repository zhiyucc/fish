<html>

<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <script src='./js/kit.fontawesome.com/a076d05399.js' crossorigin='anonymous'></script>

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.js"></script>
    <!-- JQuery嵌入 -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
    <!-- bootstrap嵌入 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8"
        crossorigin="anonymous"></script>

    <!------------------- 卡片 ---------------->
    <!-- Swiper JS  -->
    <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
    <!-- Link Swiper's CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css" />
    <!-- ------------------------------------ -->

    <script src="http://d3js.org/d3.v3.min.js"></script>
    <!-- d3嵌入 -->

    <script src="https://cdn.jsdelivr.net/npm/d3-color@3"></script>
    <!-- 顏色組合嵌入 -->

    <title>InsectWarning</title>
    <!-- ====================================================================== -->
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <!-- 長條圖的 -->
    <script src="http://120.125.83.5:88/stu/黃晏亭/InsectWarningTgos1/js/d3.tip.js"></script>
    <!-- ====================================================================== -->
    <!--   UI -->
    <script src="./js/includeHTML.js"></script>

    <!--TGOS標籤基本骨架用JS檔-->
    <script src="http://120.125.80.114/tgosd3App/js/UIcontrol_Tabs_x.js"></script>
    <script src="./js/UIcontrol_Tab1.js"></script>


    <link rel="stylesheet" type="text/css" href="./css/leftsideBar.css">
    <!--使用menu1的css檔案內容(嵌入menu1)-->
    <link rel="stylesheet" type="text/css" href="./css/rightsideInfo.css">
    <!--使用menu2的css檔案內容(嵌入menu2)-->

    <!--==INSECTTGOS===================================-->
    <script src="./js/CallCity.js"></script>
    <script src="./js/img.js"></script>
    <script src="./js/AddWmts.js"></script>
    <script src="./js/donut.js"></script>
    <script src="./js/bar.js"></script>
    <!-- <script src="./js/KMLinsect.js"></script> -->
    <script src="./js/CallTown.js"></script>
    <script src="./js/CallAdress.js"></script>
    <script src="./js/CallTown11108.js"></script>
    <script src="./js/CityZoom.js"></script>
    <link rel="stylesheet" href="./css/according.css">
    <link rel="stylesheet" type="text/css" href="./css/checkbox.css">
    <link rel="stylesheet" type="text/css" href="./css/table.css">
    <link rel="stylesheet" type="text/css" href="./css/d3.slider.css">
    <script src="./js/insect_county_108.js"></script>
    <script src="./js/insect_county_109.js"></script>
    <script src="./js/insect_county_110.js"></script>
    <script src="./js/insect_county_111.js"></script>
    <script src="./js/DrawInsect_KML.js"></script>
    <script src="./js/d3/jacky_dommadson/d3.slider.js"></script>
    <script src="./js/insect_county_108.js"></script>
    <script src="./js/insect_county_109.js"></script>
    <script src="./js/insect_county_110.js"></script>
    <script src="./js/insect_county_111.js"></script>
    <script src="./js/insect_county_declare_109.js"></script>
    <!-------------------------------------------------------卡片-------------------------------------------------------------------------------->

    <!-- Initialize Swiper -->
    <!-- <script>
    var swiper = new Swiper(".mySwiper", {
      effect: "cards",
      grabCursor: true,
    });
  </script> -->
    <style>
        html,
        body {
            position: relative;
            height: 100%;
        }

        body {
            background: #eee;
            font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
            font-size: 14px;
            color: #000;
            margin: 0;
            padding: 0;
        }

        body {
            background: #fff;
            font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
            font-size: 14px;
            color: #000;
            margin: 0;
            padding: 0;
        }

        html,
        body {
            position: relative;
            height: 100%;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .swiper {
            width: 250px;
            height: 320px;
        }

        .swiper-slide {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 18px;
            color: rgb(255, 250, 222);
        }

        .swiper-slide:nth-child(1n) {
            background-color: rgb(255, 250, 222);
        }

        .swiper-slide:nth-child(2n) {
            background-color: rgb(255, 250, 222);
        }

        .swiper-slide:nth-child(3n) {
            background-color: rgb(255, 250, 222);
        }

        .swiper-slide:nth-child(4n) {
            background-color: rgb(255, 250, 222);
        }

        .swiper-slide:nth-child(5n) {
            background-color: rgb(255, 250, 222);
        }
    </style>
    <!----------------------------------------------------------------------------------------------------------------------------------------->


    <style>
        label {
            padding: 0;
            margin-right: 3px;
            cursor: pointer;
        }

        input[type=checkbox] {
            display: inline-block;
            background-color: #aaa;
            padding: 3px 6px;
            border: 1px solid gray;
            color: #444;
            user-select: none;
            /* 防止文字被滑鼠選取反白 */
        }

        input[type=checkbox]:checked {
            color: yellow;
            background-color: #444;
        }
    </style>

    <!-- 長條圖css -->
    <style>
        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }

        .bar {
            fill: orange;
        }

        .bar:hover {
            fill: orangered;
        }

        .x.axis path {
            display: none;
        }

        .d3-tip {
            line-height: 1;
            font-weight: bold;
            padding: 12px;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            border-radius: 2px;
        }

        rect:hover {

            opacity: 0.5;
            /*滑鼠移到塗上滑鼠移到圖上會變透明*/
        }

        /* Creates a small triangle extender for the tooltip */
        .d3-tip:after {
            box-sizing: border-box;
            display: inline;
            font-size: 10px;
            width: 100%;
            line-height: 1;
            color: rgba(0, 0, 0, 0.8);
            content: "\25BC";
            position: absolute;
            text-align: center;
        }

        /* Style northward tooltips differently */
        .d3-tip.n:after {
            margin: -1px 0 0 0;
            top: 100%;
            left: 0;
        }
    </style>
    <!-- ====================================================================== -->
    <!--呼叫TGOS MAP API (lite) 金鑰------------------------------------------------------------------------->
    <!--  120.125.83.5:88 -->
    <script type="text/javascript"
        src="https://api.tgos.tw/TGOS_API/tgos?ver=2&AppID=dyM002bW773m2kGtbsy1qJfEEu9zYup+G9YOIDHimGbr49VqfO33yw==&APIKey=cGEErDNy5yN/1fQ0vyTOZrghjE+jIU6u/TO8JABJV6sRFSwkCdtfREQJzp2BSKfRUFyc8yuUxJ84LJazWZaoBeKWNJzs2MtG5d614dbCKpzE7weHaoNDtMWcS7FG3fDKSrXrj2ZrCb7EhYHfXFuMe3x9YTuaWRIHfbnyFsq16WWXAfZkMaqKGKy5xv2ze7ZldSscMbHzDk1pBd9tP2mrJh+IsPfW2U9OM1iGq2FARf5gAK/PfLaRpttBkdpZo/jD9Npk7rPCH539wHzcK9xhqYBM+hks1cOHeO8iWb4aLBR/ey/JWUdj67INpgR7SbZ3nEktvmxYZ2jb3PQYPwFkAVwpmqHdJ5WyIV0UZt1lU12+2E1KW+7rKnA/DdH22b7EaM6bHTlB6ivMY2yimumzBaM8/my2ToSl0lIy6PSzosk="
        charset="utf-8"></script>
    <!--下載後請將yourID及yourkey取代為您申請所取得的APPID及APIKEY方能正確顯示服務-->

    <!-- windy -->
    <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script>
    <script src="https://api.windy.com/assets/map-forecast/libBoot.js"></script>

    <script src="http://120.125.80.114/tgosd3App/js/tgos/TgosTools_x.js"></script>
    <script src="http://120.125.80.114/tgosd3App/js/tgos/TgosTools-kml_x.js"></script>
    <script src="http://120.125.80.114/tgosd3App/js/tgos/TgosTools-wmts_x.js"></script>
    <script src="http://120.125.80.114/tgosd3App/js/tgos/TgosTools-imageOverlay_x.js"></script>

    <script src="http://120.125.80.114/tgosd3App/js/tgos/TgosTools-customLayer_x.js"></script>
    <script src="http://120.125.80.114/tgosd3App/js/tgos/CustomLayer_x.js"></script>
    <script src="./js/WindyLayer.js"></script>

    <link rel="stylesheet" href="./css_d3/twmap/twmap.css" />


    <!-- =============================================== -->
    <script src="http://120.125.80.114/tgosd3App/js/d3/D3Layer_x.js"></script>
    <script src="http://120.125.80.114/tgosd3App/js/d3/D3plot_x.js"></script>
    <script src="http://120.125.80.114/tgosd3App/js/d3/D3LayerTools_x.js"></script>
    <link rel="stylesheet" href="./css_d3/d3layer/d3layer.css" />

    <script src="js/d3/jacky_dommadson/D3plot_arrow.js"></script>
    <script src="js/Drawinsect111.js"></script>
    <!-- =============================================== -->
    <style>
        #windy_overlay {
            /*TGMap的id元素*/
            width: 100%;
            height: 100%;
            z-index: 0;
            /*z-index改變層位，數字越大越上層*/
            transition: margin-left .5s;
            margin: 0;
            padding: 0;
            border: 0;
            position: fixed;
        }
        /*body要有這段id"<div id="TGMap"></div>"和這串id元素"#TGMap"一起出現才有作用*/
    </style>
    <style>
        #TGMap {
            /*TGMap的id元素*/
            width: 100%;
            height: 100%;
            z-index: 0;
            /*z-index改變層位，數字越大越上層*/
            transition: margin-left .5s;
            margin: 0;
            padding: 0;
            border: 0;
            position: fixed;
        }

        #windy {
            width: 100%;
            height: 100%;
            opacity: 0.6;
        }

        /*body要有這段id"<div id="TGMap"></div>"和這串id元素"#TGMap"一起出現才有作用*/
    </style>
    <style>
        #d3divTWCustomLayer {
            /*TGMap的id元素*/
            /*設成100%時，會無法偵測到滑鼠的動作*/
            width: 1%;
            height: 1%;
            z-index: 0;
            /*z-index改變層位，數字越大越上層*/
            transition: margin-left .5s;
            margin: 0;
            padding: 0;
            border: 0;
            position: fixed;
        }
    </style>
    <!-- ====================================================================== -->

    <!-- 產值產量 -->
    <link rel="stylesheet" type="text/css" href="css/btn.css" />

    <!-- 稻米 玉米 高粱 嚴重分級 -->
    <link rel="stylesheet" type="text/css" href="css/ckbox.css" />

    <!-- ---------------------------------實心圓餅圖--------------------------------------- -->
    <!-- <script>
            
        function fill_pie()
        {
            console.log("實心圓餅圖");
            var width = 250
            var height = 250
            
            var svg = d3.select("#fill_pie").append("svg")
                .attr("width",width)
                .attr("height",height)
            
            var dataSet = [["玉米", 31768.75], ["高粱", 1910.68], ["薏苡", 71.46], ["水稻", 223990.56], ["小米", 121.54], ["狼尾草", 1983.92], ["落花生", 18049.55], ["薑", 851.17]]
            
            
            var outerRadius = width / 3
            var innerRadius = 0
            
            var arc = d3.svg.arc()
                .innerRadius(innerRadius)
                .outerRadius(outerRadius)
            
            var color = [d3.rgb(214, 39, 40), d3.rgb(31, 119, 180), d3.rgb(174, 199, 232), d3.rgb(255, 127, 14), d3.rgb(255, 187, 120), d3.rgb(44, 160, 44), d3.rgb(152, 223, 138), d3.rgb(174,127,120)]
            
            // -- 圓餅圖 -- 
            draw()
            function draw()
            {
                console.log("實心draw");
                d3.transition()
                .duration(500)
                .tween("move", function(){
                return function(t){
                    
                    var pie = d3.layout.pie()
                    .startAngle(0)
                    .endAngle(Math.PI * t * 2)
                    .value(function(d){
                        return d[1]
                    })
            
                    var pieData = pie(dataSet)
                    var update = svg.selectAll("g").data(pieData)
                    update
                        .attr("transform", "translate(" + (width/2) + "," + (height/2) + ")")
                            .select("path")
                        .call(setAttr)
                    var enter = update.enter()
                        .append("g")
                            .append("path")
                    .call(setAttr)
                    var exit = update.exit()
                }
                })
                .each("end", function(d){
                    var g = svg.selectAll("g")
                
                // -- 數字 -- 
                g.append("text")
                    .attr("transform", function(d){
                    var x = arc.centroid(d)[0] * 1.4
                    var y = arc.centroid(d)[1] * 1.4
                    return "translate(" + x + "," + y+ ")"
                    })
                    .attr("text-anchor", "middle")
                    .text(function(d){
                    var percent = Number(d.value) / d3.sum(dataSet, function(d){ return d[1] }) * 100
                    return percent.toFixed(1) + "%"
                    })
            
                // -- 資料標籤 -- 
                g.append("text")
                    .attr("transform", function(d){
                    var x = arc.centroid(d)[0] * 2.5
                    var y = arc.centroid(d)[1] * 2.5
                    return "translate(" + x + "," + y + ")"
                    })
                    .attr("text-anchor", "middle")
                    .text(function(d){
                    return d.data[0]
                    })
            
                // 資料標籤的連接線   
                g.append("line")
                    .attr("stroke", "black")
                    .attr("x1", function(d){ return arc.centroid(d)[0] * 2 })
                    .attr("x2", function(d){ return arc.centroid(d)[0] * 2.2 })
                    .attr("y1", function(d){ return arc.centroid(d)[1] * 2 })
                    .attr("y2", function(d){ return arc.centroid(d)[1] * 2.2 }) 
                
                })
            }
            
            function setAttr(target)
            {
                target
                .attr("fill", function(d,i){
                return color[i]
                })
                .attr("d", function(d){
                return arc(d)
                })
            }
        }
    </script> -->
    <!-- ------------------------------------------------------------------------------- -->

    <!-- ---------------------------------玉米產值甜甜圈--------------------------------------- -->
    <script type="module">
        console.log("玉米產值甜甜圈");
        import { Runtime, Inspector } from "https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js";

        function _chart(partition, data, d3, width, color, arc, format, radius) {
            const root = partition(data);

            root.each(d => d.current = d);

            const svg = d3.create("svg")
                .attr("height", "250px")
                .attr("width", "250px")
                .attr("top", "200px")
                .attr("left", "200px")
                .attr("viewBox", [0, 0, width, width])
                .style("font", "10px sans-serif");

            const g = svg.append("g")
                .attr("transform", `translate(${width / 2},${width / 2})`);

            const path = g.append("g")
                .selectAll("path")
                .data(root.descendants().slice(1))
                .join("path")
                .attr("fill", d => { while (d.depth > 1) d = d.parent; return color(d.data.name); })
                .attr("fill-opacity", d => arcVisible(d.current) ? (d.children ? 0.6 : 0.4) : 0)
                .attr("pointer-events", d => arcVisible(d.current) ? "auto" : "none")

                .attr("d", d => arc(d.current));

            path.filter(d => d.children)
                .style("cursor", "pointer")
                .on("click", clicked);

            path.append("title")
                .text(d => `${d.ancestors().map(d => d.data.name).reverse().join("/")}\n${format(d.value)}`);

            const label = g.append("g")
                .attr("pointer-events", "none")
                .attr("text-anchor", "middle")
                .style("user-select", "none")
                .selectAll("text")
                .data(root.descendants().slice(1))
                .join("text")
                .attr("font-size", "40px")
                .attr("dy", "0.35em")
                .attr("fill-opacity", d => +labelVisible(d.current))
                .attr("transform", d => labelTransform(d.current))
                .text(d => d.data.name);

            const parent = g.append("circle")
                .datum(root)
                .attr("r", radius)
                .attr("fill", "none")
                .attr("pointer-events", "all")
                .on("click", clicked);

            function clicked(event, p) {
                parent.datum(p.parent || root);

                root.each(d => d.target = {
                    x0: Math.max(0, Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    x1: Math.max(0, Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    y0: Math.max(0, d.y0 - p.depth),
                    y1: Math.max(0, d.y1 - p.depth)
                });

                const t = g.transition().duration(750);

                path.transition(t)
                    .tween("data", d => {
                        const i = d3.interpolate(d.current, d.target);
                        return t => d.current = i(t);
                    })
                    .filter(function (d) {
                        return +this.getAttribute("fill-opacity") || arcVisible(d.target);
                    })
                    .attr("fill-opacity", d => arcVisible(d.target) ? (d.children ? 0.6 : 0.4) : 0)
                    .attr("pointer-events", d => arcVisible(d.target) ? "auto" : "none")

                    .attrTween("d", d => () => arc(d.current));

                label.filter(function (d) {
                    return +this.getAttribute("fill-opacity") || labelVisible(d.target);
                }).transition(t)
                    .attr("fill-opacity", d => +labelVisible(d.target))
                    .attrTween("transform", d => () => labelTransform(d.current));
            }

            function arcVisible(d) {
                return d.y1 <= 3 && d.y0 >= 1 && d.x1 > d.x0;
            }

            function labelVisible(d) {
                return d.y1 <= 3 && d.y0 >= 1 && (d.y1 - d.y0) * (d.x1 - d.x0) > 0.03;
            }

            function labelTransform(d) {
                const x = (d.x0 + d.x1) / 2 * 180 / Math.PI;
                const y = (d.y0 + d.y1) / 2 * radius;
                return `rotate(${x - 90}) translate(${y},0) rotate(${x < 180 ? 0 : 180})`;
            }

            return svg.node();
        }

        function _data(FileAttachment) {
            return (FileAttachment("donut110_money_corn.json").json())
        }

        function _partition(d3) {
            return (
                data => {
                    const root = d3.hierarchy(data)
                        .sum(d => d.value)
                        .sort((a, b) => b.value - a.value);
                    return d3.partition()
                        .size([2 * Math.PI, root.height + 1])
                        (root);
                }
            )
        }

        function _color(d3, data) {
            return (
                d3.scaleOrdinal(d3.quantize(d3.interpolateHcl("#599767", "#FFFAE0"), 5))
            )
        }

        function _format(d3) {
            return (
                d3.format(",d")
            )
        }

        function _width() {
            return (
                932
            )
        }

        function _radius(width) {
            return (
                width / 6
            )
        }

        function _arc(d3, radius) {
            return (
                d3.arc()
                    .startAngle(d => d.x0)
                    .endAngle(d => d.x1)
                    .padAngle(d => Math.min((d.x1 - d.x0) / 2, 0.005))
                    .padRadius(radius * 1.5)
                    .innerRadius(d => d.y0 * radius)
                    .outerRadius(d => Math.max(d.y0 * radius, d.y1 * radius - 1))
            )
        }

        export default function define(runtime, observer) {
            const main = runtime.module();
            function toString() { return this.url; }
            const fileAttachments = new Map([
                ["donut110_money_corn.json", { url: "http://120.125.83.5:88/stu/吳峻佑/InsectWarningTgos5/data/donut_data/donut110_money_corn.json", mimeType: null, toString }]
            ]);
            main.builtin("FileAttachment", runtime.fileAttachments(name => fileAttachments.get(name)));
            // main.variable(observer()).define(["md"], _1);
            main.variable(observer("chart")).define("chart", ["partition", "data", "d3", "width", "color", "arc", "format", "radius"], _chart);
            main.variable(observer("data")).define("data", ["FileAttachment"], _data);
            main.variable(observer("partition")).define("partition", ["d3"], _partition);
            main.variable(observer("color")).define("color", ["d3", "data"], _color);
            main.variable(observer("format")).define("format", ["d3"], _format);
            main.variable(observer("width")).define("width", _width);
            main.variable(observer("radius")).define("radius", ["width"], _radius);
            main.variable(observer("arc")).define("arc", ["d3", "radius"], _arc);
            return main;
        }
        new Runtime().module(define, name => {
            if (name === "chart") return new Inspector(document.querySelector("#donut_money_corn"));
        });
    </script>
    <!-- ------------------------------------------------------------------------------- -->

    <!-- ---------------------------------玉米產量甜甜圈--------------------------------------- -->
    <script type="module">
        console.log("玉米產量甜甜圈");
        import { Runtime, Inspector } from "https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js";

        function _chart(partition, data, d3, width, color, arc, format, radius) {
            const root = partition(data);

            root.each(d => d.current = d);

            const svg = d3.create("svg")
                .attr("height", "250px")
                .attr("width", "250px")
                .attr("top", "200px")
                .attr("left", "200px")
                .attr("viewBox", [0, 0, width, width])
                .style("font", "10px sans-serif");

            const g = svg.append("g")
                .attr("transform", `translate(${width / 2},${width / 2})`);

            const path = g.append("g")
                .selectAll("path")
                .data(root.descendants().slice(1))
                .join("path")
                .attr("fill", d => { while (d.depth > 1) d = d.parent; return color(d.data.name); })
                .attr("fill-opacity", d => arcVisible(d.current) ? (d.children ? 0.6 : 0.4) : 0)
                .attr("pointer-events", d => arcVisible(d.current) ? "auto" : "none")

                .attr("d", d => arc(d.current));

            path.filter(d => d.children)
                .style("cursor", "pointer")
                .on("click", clicked);

            path.append("title")
                .text(d => `${d.ancestors().map(d => d.data.name).reverse().join("/")}\n${format(d.value)}`);

            const label = g.append("g")
                .attr("pointer-events", "none")
                .attr("text-anchor", "middle")
                .style("user-select", "none")
                .selectAll("text")
                .data(root.descendants().slice(1))
                .join("text")
                .attr("font-size", "40px")
                .attr("dy", "0.35em")
                .attr("fill-opacity", d => +labelVisible(d.current))
                .attr("transform", d => labelTransform(d.current))
                .text(d => d.data.name);

            const parent = g.append("circle")
                .datum(root)
                .attr("r", radius)
                .attr("fill", "none")
                .attr("pointer-events", "all")
                .on("click", clicked);

            function clicked(event, p) {
                parent.datum(p.parent || root);

                root.each(d => d.target = {
                    x0: Math.max(0, Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    x1: Math.max(0, Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    y0: Math.max(0, d.y0 - p.depth),
                    y1: Math.max(0, d.y1 - p.depth)
                });

                const t = g.transition().duration(750);

                path.transition(t)
                    .tween("data", d => {
                        const i = d3.interpolate(d.current, d.target);
                        return t => d.current = i(t);
                    })
                    .filter(function (d) {
                        return +this.getAttribute("fill-opacity") || arcVisible(d.target);
                    })
                    .attr("fill-opacity", d => arcVisible(d.target) ? (d.children ? 0.6 : 0.4) : 0)
                    .attr("pointer-events", d => arcVisible(d.target) ? "auto" : "none")

                    .attrTween("d", d => () => arc(d.current));

                label.filter(function (d) {
                    return +this.getAttribute("fill-opacity") || labelVisible(d.target);
                }).transition(t)
                    .attr("fill-opacity", d => +labelVisible(d.target))
                    .attrTween("transform", d => () => labelTransform(d.current));
            }

            function arcVisible(d) {
                return d.y1 <= 3 && d.y0 >= 1 && d.x1 > d.x0;
            }

            function labelVisible(d) {
                return d.y1 <= 3 && d.y0 >= 1 && (d.y1 - d.y0) * (d.x1 - d.x0) > 0.03;
            }

            function labelTransform(d) {
                const x = (d.x0 + d.x1) / 2 * 180 / Math.PI;
                const y = (d.y0 + d.y1) / 2 * radius;
                return `rotate(${x - 90}) translate(${y},0) rotate(${x < 180 ? 0 : 180})`;
            }

            return svg.node();
        }

        function _data(FileAttachment) {
            return (FileAttachment("donut110_num_corn.json").json())
        }

        function _partition(d3) {
            return (
                data => {
                    const root = d3.hierarchy(data)
                        .sum(d => d.value)
                        .sort((a, b) => b.value - a.value);
                    return d3.partition()
                        .size([2 * Math.PI, root.height + 1])
                        (root);
                }
            )
        }

        function _color(d3, data) {
            return (
                d3.scaleOrdinal(d3.quantize(d3.interpolateHcl("#FFFAE0", "#599767"), 5))
            )
        }

        function _format(d3) {
            return (
                d3.format(",d")
            )
        }

        function _width() {
            return (
                932
            )
        }

        function _radius(width) {
            return (
                width / 6
            )
        }

        function _arc(d3, radius) {
            return (
                d3.arc()
                    .startAngle(d => d.x0)
                    .endAngle(d => d.x1)
                    .padAngle(d => Math.min((d.x1 - d.x0) / 2, 0.005))
                    .padRadius(radius * 1.5)
                    .innerRadius(d => d.y0 * radius)
                    .outerRadius(d => Math.max(d.y0 * radius, d.y1 * radius - 1))
            )
        }

        export default function define(runtime, observer) {
            const main = runtime.module();
            function toString() { return this.url; }
            const fileAttachments = new Map([
                ["donut110_num_corn.json", { url: "http://120.125.83.5:88/stu/吳峻佑/InsectWarningTgos5/data/donut_data/donut110_num_corn.json", mimeType: null, toString }]
            ]);
            main.builtin("FileAttachment", runtime.fileAttachments(name => fileAttachments.get(name)));
            // main.variable(observer()).define(["md"], _1);
            main.variable(observer("chart")).define("chart", ["partition", "data", "d3", "width", "color", "arc", "format", "radius"], _chart);
            main.variable(observer("data")).define("data", ["FileAttachment"], _data);
            main.variable(observer("partition")).define("partition", ["d3"], _partition);
            main.variable(observer("color")).define("color", ["d3", "data"], _color);
            main.variable(observer("format")).define("format", ["d3"], _format);
            main.variable(observer("width")).define("width", _width);
            main.variable(observer("radius")).define("radius", ["width"], _radius);
            main.variable(observer("arc")).define("arc", ["d3", "radius"], _arc);
            return main;
        }
        new Runtime().module(define, name => {
            if (name === "chart") return new Inspector(document.querySelector("#donut_num_corn"));
        });
    </script>
    <!-- ------------------------------------------------------------------------------- -->

    <!-- ---------------------------------稻米產值甜甜圈--------------------------------------- -->
    <script type="module">
        console.log("稻米產值甜甜圈");
        import { Runtime, Inspector } from "https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js";

        function _chart(partition, data, d3, width, color, arc, format, radius) {
            const root = partition(data);

            root.each(d => d.current = d);

            const svg = d3.create("svg")
                .attr("height", "250px")
                .attr("width", "250px")
                .attr("top", "200px")
                .attr("left", "200px")
                .attr("viewBox", [0, 0, width, width])
                .style("font", "10px sans-serif");

            const g = svg.append("g")
                .attr("transform", `translate(${width / 2},${width / 2})`);

            const path = g.append("g")
                .selectAll("path")
                .data(root.descendants().slice(1))
                .join("path")
                .attr("fill", d => { while (d.depth > 1) d = d.parent; return color(d.data.name); })
                .attr("fill-opacity", d => arcVisible(d.current) ? (d.children ? 0.6 : 0.4) : 0)
                .attr("pointer-events", d => arcVisible(d.current) ? "auto" : "none")

                .attr("d", d => arc(d.current));

            path.filter(d => d.children)
                .style("cursor", "pointer")
                .on("click", clicked);

            path.append("title")
                .text(d => `${d.ancestors().map(d => d.data.name).reverse().join("/")}\n${format(d.value)}`);

            const label = g.append("g")
                .attr("pointer-events", "none")
                .attr("text-anchor", "middle")
                .style("user-select", "none")
                .selectAll("text")
                .data(root.descendants().slice(1))
                .join("text")
                .attr("font-size", "40px")
                .attr("dy", "0.35em")
                .attr("fill-opacity", d => +labelVisible(d.current))
                .attr("transform", d => labelTransform(d.current))
                .text(d => d.data.name);

            const parent = g.append("circle")
                .datum(root)
                .attr("r", radius)
                .attr("fill", "none")
                .attr("pointer-events", "all")
                .on("click", clicked);

            function clicked(event, p) {
                parent.datum(p.parent || root);

                root.each(d => d.target = {
                    x0: Math.max(0, Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    x1: Math.max(0, Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    y0: Math.max(0, d.y0 - p.depth),
                    y1: Math.max(0, d.y1 - p.depth)
                });

                const t = g.transition().duration(750);

                path.transition(t)
                    .tween("data", d => {
                        const i = d3.interpolate(d.current, d.target);
                        return t => d.current = i(t);
                    })
                    .filter(function (d) {
                        return +this.getAttribute("fill-opacity") || arcVisible(d.target);
                    })
                    .attr("fill-opacity", d => arcVisible(d.target) ? (d.children ? 0.6 : 0.4) : 0)
                    .attr("pointer-events", d => arcVisible(d.target) ? "auto" : "none")

                    .attrTween("d", d => () => arc(d.current));

                label.filter(function (d) {
                    return +this.getAttribute("fill-opacity") || labelVisible(d.target);
                }).transition(t)
                    .attr("fill-opacity", d => +labelVisible(d.target))
                    .attrTween("transform", d => () => labelTransform(d.current));
            }

            function arcVisible(d) {
                return d.y1 <= 3 && d.y0 >= 1 && d.x1 > d.x0;
            }

            function labelVisible(d) {
                return d.y1 <= 3 && d.y0 >= 1 && (d.y1 - d.y0) * (d.x1 - d.x0) > 0.03;
            }

            function labelTransform(d) {
                const x = (d.x0 + d.x1) / 2 * 180 / Math.PI;
                const y = (d.y0 + d.y1) / 2 * radius;
                return `rotate(${x - 90}) translate(${y},0) rotate(${x < 180 ? 0 : 180})`;
            }

            return svg.node();
        }

        function _data(FileAttachment) {
            return (FileAttachment("donut110_money_rice.json").json())
        }

        function _partition(d3) {
            return (
                data => {
                    const root = d3.hierarchy(data)
                        .sum(d => d.value)
                        .sort((a, b) => b.value - a.value);
                    return d3.partition()
                        .size([2 * Math.PI, root.height + 1])
                        (root);
                }
            )
        }

        function _color(d3, data) {
            return (
                d3.scaleOrdinal(d3.quantize(d3.interpolateHcl("#599767", "#FFFAE0"), 5))
            )
        }

        function _format(d3) {
            return (
                d3.format(",d")
            )
        }

        function _width() {
            return (
                932
            )
        }

        function _radius(width) {
            return (
                width / 6
            )
        }

        function _arc(d3, radius) {
            return (
                d3.arc()
                    .startAngle(d => d.x0)
                    .endAngle(d => d.x1)
                    .padAngle(d => Math.min((d.x1 - d.x0) / 2, 0.005))
                    .padRadius(radius * 1.5)
                    .innerRadius(d => d.y0 * radius)
                    .outerRadius(d => Math.max(d.y0 * radius, d.y1 * radius - 1))
            )
        }

        export default function define(runtime, observer) {
            const main = runtime.module();
            function toString() { return this.url; }
            const fileAttachments = new Map([
                ["donut110_money_rice.json", { url: "http://120.125.83.5:88/stu/吳峻佑/InsectWarningTgos5/data/donut_data/donut110_money_rice.json", mimeType: null, toString }]
            ]);
            main.builtin("FileAttachment", runtime.fileAttachments(name => fileAttachments.get(name)));
            // main.variable(observer()).define(["md"], _1);
            main.variable(observer("chart")).define("chart", ["partition", "data", "d3", "width", "color", "arc", "format", "radius"], _chart);
            main.variable(observer("data")).define("data", ["FileAttachment"], _data);
            main.variable(observer("partition")).define("partition", ["d3"], _partition);
            main.variable(observer("color")).define("color", ["d3", "data"], _color);
            main.variable(observer("format")).define("format", ["d3"], _format);
            main.variable(observer("width")).define("width", _width);
            main.variable(observer("radius")).define("radius", ["width"], _radius);
            main.variable(observer("arc")).define("arc", ["d3", "radius"], _arc);
            return main;
        }
        new Runtime().module(define, name => {
            if (name === "chart") return new Inspector(document.querySelector("#donut_money_rice"));
        });
    </script>
    <!-- ------------------------------------------------------------------------------- -->

    <!-- ---------------------------------稻米產量甜甜圈--------------------------------------- -->
    <script type="module">
        console.log("稻米產量甜甜圈");
        import { Runtime, Inspector } from "https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js";

        function _chart(partition, data, d3, width, color, arc, format, radius) {
            const root = partition(data);

            root.each(d => d.current = d);

            const svg = d3.create("svg")
                .attr("height", "250px")
                .attr("width", "250px")
                .attr("top", "200px")
                .attr("left", "200px")
                .attr("viewBox", [0, 0, width, width])
                .style("font", "10px sans-serif");

            const g = svg.append("g")
                .attr("transform", `translate(${width / 2},${width / 2})`);

            const path = g.append("g")
                .selectAll("path")
                .data(root.descendants().slice(1))
                .join("path")
                .attr("fill", d => { while (d.depth > 1) d = d.parent; return color(d.data.name); })
                .attr("fill-opacity", d => arcVisible(d.current) ? (d.children ? 0.6 : 0.4) : 0)
                .attr("pointer-events", d => arcVisible(d.current) ? "auto" : "none")

                .attr("d", d => arc(d.current));

            path.filter(d => d.children)
                .style("cursor", "pointer")
                .on("click", clicked);

            path.append("title")
                .text(d => `${d.ancestors().map(d => d.data.name).reverse().join("/")}\n${format(d.value)}`);

            const label = g.append("g")
                .attr("pointer-events", "none")
                .attr("text-anchor", "middle")
                .style("user-select", "none")
                .selectAll("text")
                .data(root.descendants().slice(1))
                .join("text")
                .attr("font-size", "40px")
                .attr("dy", "0.35em")
                .attr("fill-opacity", d => +labelVisible(d.current))
                .attr("transform", d => labelTransform(d.current))
                .text(d => d.data.name);

            const parent = g.append("circle")
                .datum(root)
                .attr("r", radius)
                .attr("fill", "none")
                .attr("pointer-events", "all")
                .on("click", clicked);

            function clicked(event, p) {
                parent.datum(p.parent || root);

                root.each(d => d.target = {
                    x0: Math.max(0, Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    x1: Math.max(0, Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    y0: Math.max(0, d.y0 - p.depth),
                    y1: Math.max(0, d.y1 - p.depth)
                });

                const t = g.transition().duration(750);

                path.transition(t)
                    .tween("data", d => {
                        const i = d3.interpolate(d.current, d.target);
                        return t => d.current = i(t);
                    })
                    .filter(function (d) {
                        return +this.getAttribute("fill-opacity") || arcVisible(d.target);
                    })
                    .attr("fill-opacity", d => arcVisible(d.target) ? (d.children ? 0.6 : 0.4) : 0)
                    .attr("pointer-events", d => arcVisible(d.target) ? "auto" : "none")

                    .attrTween("d", d => () => arc(d.current));

                label.filter(function (d) {
                    return +this.getAttribute("fill-opacity") || labelVisible(d.target);
                }).transition(t)
                    .attr("fill-opacity", d => +labelVisible(d.target))
                    .attrTween("transform", d => () => labelTransform(d.current));
            }

            function arcVisible(d) {
                return d.y1 <= 3 && d.y0 >= 1 && d.x1 > d.x0;
            }

            function labelVisible(d) {
                return d.y1 <= 3 && d.y0 >= 1 && (d.y1 - d.y0) * (d.x1 - d.x0) > 0.03;
            }

            function labelTransform(d) {
                const x = (d.x0 + d.x1) / 2 * 180 / Math.PI;
                const y = (d.y0 + d.y1) / 2 * radius;
                return `rotate(${x - 90}) translate(${y},0) rotate(${x < 180 ? 0 : 180})`;
            }

            return svg.node();
        }

        function _data(FileAttachment) {
            return (FileAttachment("donut110_num_rice.json").json())
        }

        function _partition(d3) {
            return (
                data => {
                    const root = d3.hierarchy(data)
                        .sum(d => d.value)
                        .sort((a, b) => b.value - a.value);
                    return d3.partition()
                        .size([2 * Math.PI, root.height + 1])
                        (root);
                }
            )
        }

        function _color(d3, data) {
            return (
                d3.scaleOrdinal(d3.quantize(d3.interpolateHcl("#FFFAE0", "#599767"), 5))
            )
        }

        function _format(d3) {
            return (
                d3.format(",d")
            )
        }

        function _width() {
            return (
                932
            )
        }

        function _radius(width) {
            return (
                width / 6
            )
        }

        function _arc(d3, radius) {
            return (
                d3.arc()
                    .startAngle(d => d.x0)
                    .endAngle(d => d.x1)
                    .padAngle(d => Math.min((d.x1 - d.x0) / 2, 0.005))
                    .padRadius(radius * 1.5)
                    .innerRadius(d => d.y0 * radius)
                    .outerRadius(d => Math.max(d.y0 * radius, d.y1 * radius - 1))
            )
        }

        export default function define(runtime, observer) {
            const main = runtime.module();
            function toString() { return this.url; }
            const fileAttachments = new Map([
                ["donut110_num_rice.json", { url: "http://120.125.83.5:88/stu/吳峻佑/InsectWarningTgos5/data/donut_data/donut110_num_rice.json", mimeType: null, toString }]
            ]);
            main.builtin("FileAttachment", runtime.fileAttachments(name => fileAttachments.get(name)));
            // main.variable(observer()).define(["md"], _1);
            main.variable(observer("chart")).define("chart", ["partition", "data", "d3", "width", "color", "arc", "format", "radius"], _chart);
            main.variable(observer("data")).define("data", ["FileAttachment"], _data);
            main.variable(observer("partition")).define("partition", ["d3"], _partition);
            main.variable(observer("color")).define("color", ["d3", "data"], _color);
            main.variable(observer("format")).define("format", ["d3"], _format);
            main.variable(observer("width")).define("width", _width);
            main.variable(observer("radius")).define("radius", ["width"], _radius);
            main.variable(observer("arc")).define("arc", ["d3", "radius"], _arc);
            return main;
        }
        new Runtime().module(define, name => {
            if (name === "chart") return new Inspector(document.querySelector("#donut_num_rice"));
        });
    </script>
    <!-- ------------------------------------------------------------------------------- -->

    <!-- ---------------------------------高粱產值甜甜圈--------------------------------------- -->
    <script type="module">
        console.log("高粱產值甜甜圈");
        import { Runtime, Inspector } from "https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js";

        function _chart(partition, data, d3, width, color, arc, format, radius) {
            const root = partition(data);

            root.each(d => d.current = d);

            const svg = d3.create("svg")
                .attr("height", "250px")
                .attr("width", "250px")
                .attr("top", "200px")
                .attr("left", "200px")
                .attr("viewBox", [0, 0, width, width])
                .style("font", "10px sans-serif");

            const g = svg.append("g")
                .attr("transform", `translate(${width / 2},${width / 2})`);

            const path = g.append("g")
                .selectAll("path")
                .data(root.descendants().slice(1))
                .join("path")
                .attr("fill", d => { while (d.depth > 1) d = d.parent; return color(d.data.name); })
                .attr("fill-opacity", d => arcVisible(d.current) ? (d.children ? 0.6 : 0.4) : 0)
                .attr("pointer-events", d => arcVisible(d.current) ? "auto" : "none")

                .attr("d", d => arc(d.current));

            path.filter(d => d.children)
                .style("cursor", "pointer")
                .on("click", clicked);

            path.append("title")
                .text(d => `${d.ancestors().map(d => d.data.name).reverse().join("/")}\n${format(d.value)}`);

            const label = g.append("g")
                .attr("pointer-events", "none")
                .attr("text-anchor", "middle")
                .style("user-select", "none")
                .selectAll("text")
                .data(root.descendants().slice(1))
                .join("text")
                .attr("font-size", "40px")
                .attr("dy", "0.35em")
                .attr("fill-opacity", d => +labelVisible(d.current))
                .attr("transform", d => labelTransform(d.current))
                .text(d => d.data.name);

            const parent = g.append("circle")
                .datum(root)
                .attr("r", radius)
                .attr("fill", "none")
                .attr("pointer-events", "all")
                .on("click", clicked);

            function clicked(event, p) {
                parent.datum(p.parent || root);

                root.each(d => d.target = {
                    x0: Math.max(0, Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    x1: Math.max(0, Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    y0: Math.max(0, d.y0 - p.depth),
                    y1: Math.max(0, d.y1 - p.depth)
                });

                const t = g.transition().duration(750);

                path.transition(t)
                    .tween("data", d => {
                        const i = d3.interpolate(d.current, d.target);
                        return t => d.current = i(t);
                    })
                    .filter(function (d) {
                        return +this.getAttribute("fill-opacity") || arcVisible(d.target);
                    })
                    .attr("fill-opacity", d => arcVisible(d.target) ? (d.children ? 0.6 : 0.4) : 0)
                    .attr("pointer-events", d => arcVisible(d.target) ? "auto" : "none")

                    .attrTween("d", d => () => arc(d.current));

                label.filter(function (d) {
                    return +this.getAttribute("fill-opacity") || labelVisible(d.target);
                }).transition(t)
                    .attr("fill-opacity", d => +labelVisible(d.target))
                    .attrTween("transform", d => () => labelTransform(d.current));
            }

            function arcVisible(d) {
                return d.y1 <= 3 && d.y0 >= 1 && d.x1 > d.x0;
            }

            function labelVisible(d) {
                return d.y1 <= 3 && d.y0 >= 1 && (d.y1 - d.y0) * (d.x1 - d.x0) > 0.03;
            }

            function labelTransform(d) {
                const x = (d.x0 + d.x1) / 2 * 180 / Math.PI;
                const y = (d.y0 + d.y1) / 2 * radius;
                return `rotate(${x - 90}) translate(${y},0) rotate(${x < 180 ? 0 : 180})`;
            }

            return svg.node();
        }

        function _data(FileAttachment) {
            return (FileAttachment("donut110_money_gl.json").json())
        }

        function _partition(d3) {
            return (
                data => {
                    const root = d3.hierarchy(data)
                        .sum(d => d.value)
                        .sort((a, b) => b.value - a.value);
                    return d3.partition()
                        .size([2 * Math.PI, root.height + 1])
                        (root);
                }
            )
        }

        function _color(d3, data) {
            return (
                d3.scaleOrdinal(d3.quantize(d3.interpolateHcl("#599767", "#FFFAE0"), 5))
            )
        }

        function _format(d3) {
            return (
                d3.format(",d")
            )
        }

        function _width() {
            return (
                932
            )
        }

        function _radius(width) {
            return (
                width / 6
            )
        }

        function _arc(d3, radius) {
            return (
                d3.arc()
                    .startAngle(d => d.x0)
                    .endAngle(d => d.x1)
                    .padAngle(d => Math.min((d.x1 - d.x0) / 2, 0.005))
                    .padRadius(radius * 1.5)
                    .innerRadius(d => d.y0 * radius)
                    .outerRadius(d => Math.max(d.y0 * radius, d.y1 * radius - 1))
            )
        }

        export default function define(runtime, observer) {
            const main = runtime.module();
            function toString() { return this.url; }
            const fileAttachments = new Map([
                ["donut110_money_gl.json", { url: "http://120.125.83.5:88/stu/吳峻佑/InsectWarningTgos5/data/donut_data/donut110_money_gl.json", mimeType: null, toString }]
            ]);
            main.builtin("FileAttachment", runtime.fileAttachments(name => fileAttachments.get(name)));
            // main.variable(observer()).define(["md"], _1);
            main.variable(observer("chart")).define("chart", ["partition", "data", "d3", "width", "color", "arc", "format", "radius"], _chart);
            main.variable(observer("data")).define("data", ["FileAttachment"], _data);
            main.variable(observer("partition")).define("partition", ["d3"], _partition);
            main.variable(observer("color")).define("color", ["d3", "data"], _color);
            main.variable(observer("format")).define("format", ["d3"], _format);
            main.variable(observer("width")).define("width", _width);
            main.variable(observer("radius")).define("radius", ["width"], _radius);
            main.variable(observer("arc")).define("arc", ["d3", "radius"], _arc);
            return main;
        }
        new Runtime().module(define, name => {
            if (name === "chart") return new Inspector(document.querySelector("#donut_money_gl"));
        });
    </script>
    <!-- ------------------------------------------------------------------------------- -->

    <!-- ---------------------------------高粱產量甜甜圈--------------------------------------- -->
    <script type="module">
        console.log("高粱產量甜甜圈");
        import { Runtime, Inspector } from "https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js";

        function _chart(partition, data, d3, width, color, arc, format, radius) {
            const root = partition(data);

            root.each(d => d.current = d);

            const svg = d3.create("svg")
                .attr("height", "250px")
                .attr("width", "250px")
                .attr("top", "200px")
                .attr("left", "200px")
                .attr("viewBox", [0, 0, width, width])
                .style("font", "10px sans-serif");

            const g = svg.append("g")
                .attr("transform", `translate(${width / 2},${width / 2})`);

            const path = g.append("g")
                .selectAll("path")
                .data(root.descendants().slice(1))
                .join("path")
                .attr("fill", d => { while (d.depth > 1) d = d.parent; return color(d.data.name); })
                .attr("fill-opacity", d => arcVisible(d.current) ? (d.children ? 0.6 : 0.4) : 0)
                .attr("pointer-events", d => arcVisible(d.current) ? "auto" : "none")

                .attr("d", d => arc(d.current));

            path.filter(d => d.children)
                .style("cursor", "pointer")
                .on("click", clicked);

            path.append("title")
                .text(d => `${d.ancestors().map(d => d.data.name).reverse().join("/")}\n${format(d.value)}`);

            const label = g.append("g")
                .attr("pointer-events", "none")
                .attr("text-anchor", "middle")
                .style("user-select", "none")
                .selectAll("text")
                .data(root.descendants().slice(1))
                .join("text")
                .attr("font-size", "40px")
                .attr("dy", "0.35em")
                .attr("fill-opacity", d => +labelVisible(d.current))
                .attr("transform", d => labelTransform(d.current))
                .text(d => d.data.name);

            const parent = g.append("circle")
                .datum(root)
                .attr("r", radius)
                .attr("fill", "none")
                .attr("pointer-events", "all")
                .on("click", clicked);

            function clicked(event, p) {
                parent.datum(p.parent || root);

                root.each(d => d.target = {
                    x0: Math.max(0, Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    x1: Math.max(0, Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    y0: Math.max(0, d.y0 - p.depth),
                    y1: Math.max(0, d.y1 - p.depth)
                });

                const t = g.transition().duration(750);

                path.transition(t)
                    .tween("data", d => {
                        const i = d3.interpolate(d.current, d.target);
                        return t => d.current = i(t);
                    })
                    .filter(function (d) {
                        return +this.getAttribute("fill-opacity") || arcVisible(d.target);
                    })
                    .attr("fill-opacity", d => arcVisible(d.target) ? (d.children ? 0.6 : 0.4) : 0)
                    .attr("pointer-events", d => arcVisible(d.target) ? "auto" : "none")

                    .attrTween("d", d => () => arc(d.current));

                label.filter(function (d) {
                    return +this.getAttribute("fill-opacity") || labelVisible(d.target);
                }).transition(t)
                    .attr("fill-opacity", d => +labelVisible(d.target))
                    .attrTween("transform", d => () => labelTransform(d.current));
            }

            function arcVisible(d) {
                return d.y1 <= 3 && d.y0 >= 1 && d.x1 > d.x0;
            }

            function labelVisible(d) {
                return d.y1 <= 3 && d.y0 >= 1 && (d.y1 - d.y0) * (d.x1 - d.x0) > 0.03;
            }

            function labelTransform(d) {
                const x = (d.x0 + d.x1) / 2 * 180 / Math.PI;
                const y = (d.y0 + d.y1) / 2 * radius;
                return `rotate(${x - 90}) translate(${y},0) rotate(${x < 180 ? 0 : 180})`;
            }

            return svg.node();
        }

        function _data(FileAttachment) {
            return (FileAttachment("donut110_num_gl.json").json())
        }

        function _partition(d3) {
            return (
                data => {
                    const root = d3.hierarchy(data)
                        .sum(d => d.value)
                        .sort((a, b) => b.value - a.value);
                    return d3.partition()
                        .size([2 * Math.PI, root.height + 1])
                        (root);
                }
            )
        }

        function _color(d3, data) {
            return (
                d3.scaleOrdinal(d3.quantize(d3.interpolateHcl("#FFFAE0", "#599767"), 5))
            )
        }

        function _format(d3) {
            return (
                d3.format(",d")
            )
        }

        function _width() {
            return (
                932
            )
        }

        function _radius(width) {
            return (
                width / 6
            )
        }

        function _arc(d3, radius) {
            return (
                d3.arc()
                    .startAngle(d => d.x0)
                    .endAngle(d => d.x1)
                    .padAngle(d => Math.min((d.x1 - d.x0) / 2, 0.005))
                    .padRadius(radius * 1.5)
                    .innerRadius(d => d.y0 * radius)
                    .outerRadius(d => Math.max(d.y0 * radius, d.y1 * radius - 1))
            )
        }

        export default function define(runtime, observer) {
            const main = runtime.module();
            function toString() { return this.url; }
            const fileAttachments = new Map([
                ["donut110_num_gl.json", { url: "http://120.125.83.5:88/stu/吳峻佑/InsectWarningTgos5/data/donut_data/donut110_num_gl.json", mimeType: null, toString }]
            ]);
            main.builtin("FileAttachment", runtime.fileAttachments(name => fileAttachments.get(name)));
            // main.variable(observer()).define(["md"], _1);
            main.variable(observer("chart")).define("chart", ["partition", "data", "d3", "width", "color", "arc", "format", "radius"], _chart);
            main.variable(observer("data")).define("data", ["FileAttachment"], _data);
            main.variable(observer("partition")).define("partition", ["d3"], _partition);
            main.variable(observer("color")).define("color", ["d3", "data"], _color);
            main.variable(observer("format")).define("format", ["d3"], _format);
            main.variable(observer("width")).define("width", _width);
            main.variable(observer("radius")).define("radius", ["width"], _radius);
            main.variable(observer("arc")).define("arc", ["d3", "radius"], _arc);
            return main;
        }
        new Runtime().module(define, name => {
            if (name === "chart") return new Inspector(document.querySelector("#donut_num_gl"));
        });
    </script>
    <!-- ------------------------------------------------------------------------------- -->


    <!-- ---------------------------------修改tgos地圖甜甜圈--------------------------------------- -->
    <!-- <script type="module">
        console.log("甜甜圈");
        import { Runtime, Inspector } from "https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js";

        function _chart(partition, data, d3, width, color, arc, format, radius) {
            const root = partition(data);

            root.each(d => d.current = d);

            const svg = d3.create("svg")
                .attr("top", "400px")
                .attr("left", "400px")
                .attr("height", "300px")
                .attr("width", "300px")
                .attr("viewBox", [0, 0, width, width])
                .style("font", "10px sans-serif")
                .attr("transform", "translate(24,24)");

            const g = svg.append("g")
                .attr("transform", `translate(${width / 2},${width / 2})`);

            const path = g.append("g")
                .selectAll("path")
                .data(root.descendants().slice(1))
                .join("path")
                .attr("fill", d => { while (d.depth > 1) d = d.parent; return color(d.data.name); })
                .attr("fill-opacity", d => arcVisible(d.current) ? (d.children ? 0.6 : 0.4) : 0)
                .attr("pointer-events", d => arcVisible(d.current) ? "auto" : "none")

                .attr("d", d => arc(d.current));

            path.filter(d => d.children)
                .style("cursor", "pointer")
                .on("click", clicked);

            path.append("title")
                .text(d => `${d.ancestors().map(d => d.data.name).reverse().join("/")}\n${format(d.value)}`)

            const label = g.append("g")
                .attr("pointer-events", "none")
                .attr("text-anchor", "middle")
                .style("user-select", "none")
                .selectAll("text")
                .data(root.descendants().slice(1))
                .join("text")
                .attr("font-size", "30px")
                .attr("dy", "0.35em")
                .attr("fill-opacity", d => +labelVisible(d.current))
                .attr("transform", d => labelTransform(d.current))
                .text(d => d.data.name);

            const parent = g.append("circle")
                .datum(root)
                .attr("r", radius)
                .attr("fill", "none")
                .attr("pointer-events", "all")
                .on("click", clicked);

            function clicked(event, p) {
                parent.datum(p.parent || root);

                root.each(d => d.target = {
                    x0: Math.max(0, Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    x1: Math.max(0, Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    y0: Math.max(0, d.y0 - p.depth),
                    y1: Math.max(0, d.y1 - p.depth)
                });

                const t = g.transition().duration(750);

                path.transition(t)
                    .tween("data", d => {
                        const i = d3.interpolate(d.current, d.target);
                        return t => d.current = i(t);
                    })
                    .filter(function (d) {
                        return +this.getAttribute("fill-opacity") || arcVisible(d.target);
                    })
                    .attr("fill-opacity", d => arcVisible(d.target) ? (d.children ? 0.6 : 0.4) : 0)
                    .attr("pointer-events", d => arcVisible(d.target) ? "auto" : "none")

                    .attrTween("d", d => () => arc(d.current));

                label.filter(function (d) {
                    return +this.getAttribute("fill-opacity") || labelVisible(d.target);
                }).transition(t)
                    .attr("fill-opacity", d => +labelVisible(d.target))
                    .attrTween("transform", d => () => labelTransform(d.current));
            }

            function arcVisible(d) {
                return d.y1 <= 3 && d.y0 >= 1 && d.x1 > d.x0;
            }

            function labelVisible(d) {
                return d.y1 <= 3 && d.y0 >= 1 && (d.y1 - d.y0) * (d.x1 - d.x0) > 0.03;
            }

            function labelTransform(d) {
                const x = (d.x0 + d.x1) / 2 * 180 / Math.PI;
                const y = (d.y0 + d.y1) / 2 * radius;
                return `rotate(${x - 90}) translate(${y},0) rotate(${x < 180 ? 0 : 180})`;
            }

            return svg.node();
        }

        function _data(FileAttachment) {
            return (
                FileAttachment("donut_num.json").json()
            )
        }

        function _partition(d3) {
            return (
                data => {
                    const root = d3.hierarchy(data)
                        .sum(d => d.value)
                        .sort((a, b) => b.value - a.value);
                    return d3.partition()
                        .size([2 * Math.PI, root.height + 1])
                        (root);
                }
            )
        }

        function _color(d3, data) {
            return (
                // d3.scaleOrdinal(d3.quantize( d3.schemeAccent, data.children.length + 1))
                d3.scaleOrdinal(d3.quantize(d3.interpolateHcl("#FFD306", "#0072E3"), 3))
            )
        }

        function _format(d3) {
            return (
                d3.format(",d")
            )
        }

        function _width() {
            return (
                932
            )
        }

        function _radius(width) {
            return (
                width / 6
            )
        }

        function _arc(d3, radius) {
            return (
                d3.arc()
                    .startAngle(d => d.x0)
                    .endAngle(d => d.x1)
                    .padAngle(d => Math.min((d.x1 - d.x0) / 2, 0.005))
                    .padRadius(radius * 1.5)
                    .innerRadius(d => d.y0 * radius)
                    .outerRadius(d => Math.max(d.y0 * radius, d.y1 * radius - 1))
            )
        }

        export default function define(runtime, observer) {
            const main = runtime.module();
            function toString() { return this.url; }
            const fileAttachments = new Map([
                ["donut_num.json", { url: "http://120.125.83.5:88/stu/林昀晗/新聞動畫/data/donut_num.json", mimeType: null, toString }]
            ]);
            main.builtin("FileAttachment", runtime.fileAttachments(name => fileAttachments.get(name)));
            // main.variable(observer()).define(["md"], _1);
            main.variable(observer("chart")).define("chart", ["partition", "data", "d3", "width", "color", "arc", "format", "radius"], _chart);
            main.variable(observer("data")).define("data", ["FileAttachment"], _data);
            main.variable(observer("partition")).define("partition", ["d3"], _partition);
            main.variable(observer("color")).define("color", ["d3", "data"], _color);
            main.variable(observer("format")).define("format", ["d3"], _format);
            main.variable(observer("width")).define("width", _width);
            main.variable(observer("radius")).define("radius", ["width"], _radius);
            main.variable(observer("arc")).define("arc", ["d3", "radius"], _arc);
            return main;
        }
        new Runtime().module(define, name => {
            if (name === "chart") return new Inspector(document.querySelector("#observablehq-chart-4eb1c81c"));
        });
    </script> -->
    <!-- ------------------------------------------------------------------------------- -->

    <!-- ---------------------------------長條圖--------------------------------------- -->
    <script>
        function bar() {
            console.log("長條圖");
            var margin = { top: 40, right: 20, bottom: 30, left: 40 },
                width = 250,
                height = 250;

            // var formatPercent = d3.format(".0%");

            var x = d3.scale.ordinal()
                .rangeRoundBands([0, width], .1);

            var y = d3.scale.linear()
                .range([height, 0]);

            var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom");

            var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")
                .ticks(5);

            var tip = d3.tip()
                .attr('class', 'd3-tip')
                .offset([-10, 0])
                .html(function (d) {
                    return "<strong>數量:</strong> <span style='color:white'>" + d.number + "</span>";
                })

            console.log(d3.select("#barchat"));

            var svg = d3.select("#barchat").append("svg")
                .attr("preserveAspectRatio", "xMidYMid slice")
                .attr("viewBox", "-20 0 350 350")
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            svg.call(tip);

            d3.tsv("data/dat.tsv", type, function (error, data) {
                x.domain(data.map(function (d) { return d.letter; }));
                y.domain([0, d3.max(data, function (d) { return d.number; })]);

                svg.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    // 沒用
                    // .attr("width", 50)
                    // .attr("height", 50)
                    .call(xAxis)
                    .append("text")
                    .attr("transform", "translate(280,7)")
                    //   .attr("transform", "rotate(-90)")
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .style('font-size', '16px')
                    .text("月份");

                svg.append("g")
                    .attr("class", "y axis")
                    // 沒用
                    // .attr("width", 50)
                    // .attr("height", 50)
                    .call(yAxis)
                    .append("text")
                    .attr("transform", "translate(5,-30)")
                    //   .attr("transform", "rotate(-90)")
                    .attr("y", 6)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .style('font-size', '16px')
                    .text("數量");

                svg.selectAll(".bar")
                    .data(data)
                    .enter().append("rect")
                    .attr("class", "bar")
                    .attr("x", function (d) { return x(d.letter); })
                    .attr("width", x.rangeBand())
                    .attr("y", function (d) { return y(d.number); })
                    .attr("height", function (d) { return height - y(d.number); })
                    .on('mouseover', tip.show)
                    .on('mouseout', tip.hide)

            });

            function type(d) {
                d.number = +d.number;
                return d;
            }

        }
    </script>
    <!-- ------------------------------------------------------------------------------- -->

    <script type="text/javascript">
        var tgosLayer;
        var pMap;
        window.onload = function () { //window.onload() 方法用于在网页加载完毕后立刻执行的操作
            InitWnd_tgos();
            aaa();
            //setCheckboxEvent();  //因為使用includeHTML()方式，因此此行沒有發生作用
        };

        function InitWnd_tgos() {
            var pOMap = document.getElementById("TGMap"); //宣告一個網頁容器

            var mapOptions = {
                mapTypeControl: false //mapTypeControl(關閉地圖類型控制項)
            };

            pMap = new TGOS.TGOnlineMap(pOMap, TGOS.TGCoordSys.EPSG3857); //宣告TGOnlineMap地圖物件並設定坐標系統
            //   pMap.setCenter(new TGOS.TGPoint(248170.723962947, 2650129.97744621));
            //=============================================================================
            tgosTools = new TgosTools(pMap);
            tgosTools.addKeyListener("body");

            //加入風場Layer
            var WindyLayerId = "InsectWindy";
            windyLayer = new WindyLayer(WindyLayerId, pMap);
        }

        // function InitWnd_windy() {
        //     const options = {
        //         key: 'EPcyVH8JNTyyZmcsqdKSXNPtPCYjZgRG', // REPLACE WITH YOUR KEY !!!
        //         lat: 23.609490776192782,
        //         lon: 120.50026255654997,
        //         zoom: 8,
        //     };

        //     windyInit(options, windyAPI => {
        //         const { map } = windyAPI;
        //     });

        //     // L.Control.setPosition("topright");
            

        //     if ($('#windy_ckbox').is(':checked')) {
        //         $("#windy").show();
        //     }
        //     else {
        //         $("#windy").hide();
        //     }
        // }
    </script>
    <style>
        #years_month
        {
            border:dashed 2px #FCFACF; 
            font-size: 25px; 
            background-color: rgb(89, 152, 104); 
            color:#FCFACF; 
            height: 40px; width: 200px; 
            text-align: center; 
            margin-left:-400px; 
            margin-top:-500px;
            border-radius: 25px;
            z-index: 1;
        }
        #month_109{
            font-size: 15px;
            margin-left:-600px; 
            margin-bottom: -150px;
            text-align: center; 
            height: 450px; width: 60px;
            background-color:rgb(89, 152, 104);
            color:#FCFACF; 
            border-radius: 10px;
            z-index: 1;
        }
        #declare_109{
            font-size: 15px;
            margin-left:-600px; 
            margin-bottom: -150px;
            text-align: center; 
            height: 450px; width: 60px;
            background-color:rgb(89, 152, 104);
            color:#FCFACF; 
            border-radius: 10px;
            z-index: 1;
        }
    </style>
</head>

<body>

    <div id="TGMap">
        <div id="slider5"></div>
    </div>

    <div id="windy" style="display: none;"></div>

    <div id="years_month" style="display: none;">
        <p id="years_month_p"></p>
    </div>
    <div id="month_109" style="display: none;">
        <p id="insect10904" onclick="insect10904(0)">4月</p>
        <p id="insect10905" onclick="insect10905(0)">5月</p>
        <p id="insect10906" onclick="insect10906(0)">6月</p>
        <p id="insect10907" onclick="insect10907(0)">7月</p>
        <p id="insect10908" onclick="insect10908(0)">8月</p>
        <p id="insect10909" onclick="insect10909(0)">9月</p>
        <p id="insect10910" onclick="insect10910(0)">10月</p>
        <p id="insect10911" onclick="insect10911(0)">11月</p>
        <p id="insect10912" onclick="insect10912(0)">12月</p>
    </div>
    <div id="declare_109" style="display: none;">
        <p  onclick="declare10901(0)" id="declare10901">1月</p>
        <p  onclick="declare10902(0)" id="declare10902">2月</p>
        <p  onclick="declare10903(0)" id="declare10903">3月</p>
        <p  onclick="declare10904(0)" id="declare10904">4月</p>
        <p  onclick="declare10905(0)" id="declare10905">5月</p>
        <p  onclick="declare10906(0)" id="declare10906">6月</p>
        <p  onclick="declare10907(0)" id="declare10907">7月</p>
        <p  onclick="declare10908(0)" id="declare10908">8月</p>
        <p  onclick="declare10909(0)" id="declare10909">9月</p>
        <p  onclick="declare10910(0)" id="declare109010">10月</p>
        <p  onclick="declare10911(0)" id="declare109011">11月</p>
        <p  onclick="declare10912(0)" id="declare109012">12月</p>
        
    </div>


    <!-- 甜甜圈 -->
    <!-- <div id="observablehq-chart-4eb1c81c"style="margin-top:200px; margin-left:800px; z-index: 99999; 
    height:350px; width:350px; background-color: white; border-radius: 50%;"></div> -->

    <div id="tooltip" class="hidden" style="z-index: 1000;"></div>

    <div w3-include-html="htmlForInclude/leftsidemenu.html"></div>

    <div w3-include-html="htmlForInclude/rightsidemenu.html"></div>

    <script>
        includeHTML();  //呼叫
    </script>
</body>

</html>